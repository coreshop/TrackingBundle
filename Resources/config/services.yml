services:
    coreshop.registry.tracking.tracker:
        class: CoreShop\Component\Registry\ServiceRegistry
        arguments:
            - CoreShop\Bundle\TrackingBundle\Tracker\EcommerceTrackerInterface
            - 'tracker'

    coreshop.tracking.item_builder:
        class: CoreShop\Bundle\TrackingBundle\Builder\ItemBuilder
        arguments:
            - '@coreshop.order.purchasable.price_calculator'

    coreshop.tracking.resolver.tracking_config:
        class: CoreShop\Bundle\TrackingBundle\Resolver\ConfigResolver
        arguments:
            - '@Pimcore\Analytics\SiteId\SiteIdProvider'
            - '@Pimcore\Analytics\Google\Config\ConfigProvider'

    coreshop.tracking.tracker.ecommerce_tracker:
        class: CoreShop\Bundle\TrackingBundle\Tracker\EcommerceTracker
        abstract: true
        arguments:
            - '@templating.engine.delegating'
            - '@coreshop.tracking.item_builder'
            - '@coreshop.context.currency'

    coreshop.tracking.tracker.google.analytics.enhanced_ecommerce:
        class: CoreShop\Bundle\TrackingBundle\Tracker\Google\AnalyticsEnhancedEcommerce
        parent: coreshop.tracking.tracker.ecommerce_tracker
        calls:
            - [setTracker, ['@Pimcore\Analytics\Google\Tracker']]
            - [setConfigResolver, ['@coreshop.tracking.resolver.tracking_config']]
        tags:
            - { name: coreshop.tracking.tracker, type: google-analytics-enhanced-ecommerce }

    coreshop.tracking.tracker.google.analytics.universal_ecommerce:
        class: CoreShop\Bundle\TrackingBundle\Tracker\Google\UniversalEcommerce
        parent: coreshop.tracking.tracker.ecommerce_tracker
        calls:
            - [setTracker, ['@Pimcore\Analytics\Google\Tracker']]
            - [setConfigResolver, ['@coreshop.tracking.resolver.tracking_config']]
        tags:
            - { name: coreshop.tracking.tracker, type: google-analytics-universal-ecommerce }

    coreshop.tracking.tracker.google.analytics.gtag_enhanced_ecommerce:
        class: CoreShop\Bundle\TrackingBundle\Tracker\Google\GoogleTagEnhancedEcommerce
        parent: coreshop.tracking.tracker.ecommerce_tracker
        calls:
            - [setTracker, ['@Pimcore\Analytics\Google\Tracker']]
            - [setConfigResolver, ['@coreshop.tracking.resolver.tracking_config']]
        tags:
            - { name: coreshop.tracking.tracker, type: google-tag-enhanced-ecommerce }

    coreshop.tracking.tracker.piwik:
        class: CoreShop\Bundle\TrackingBundle\Tracker\Piwik\Piwik
        parent: coreshop.tracking.tracker.ecommerce_tracker
        calls:
            - [setTracker, ['@Pimcore\Analytics\Piwik\Tracker']]
        tags:
            - { name: coreshop.tracking.tracker, type: piwik }

    coreshop.tracking.manager:
        class: CoreShop\Bundle\TrackingBundle\Manager\TrackingManager
        arguments:
            - '@coreshop.registry.tracking.tracker'